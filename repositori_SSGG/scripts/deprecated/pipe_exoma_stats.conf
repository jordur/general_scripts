# Remove duplicates
MarkDuplicates.jar I=solid0065_20110110_PE_BC_FC2_Cardio_MamaColon_Cardio_F3_BM3062.csfasta.ma.bam O=F3_no_dup.bam M=F3_no_dup.log REMOVE_DUPLICATES=true TMP_DIR=/scratch

# Sequences (with duplicates) get piled up against the reference
/share/apps/samtools-0.1.9/samtools pileup -cf /data/results/Solid0065/referencia_genoma_humano/GRch37.58/hg19.fa solid0065_20110110_PE_BC_FC2_Cardio_MamaColon_Cardio_F3_BM3062.csfasta.ma.bam > F3.pileup

# Sequences (without duplicates) get piled up against the reference
/share/apps/samtools-0.1.9/samtools pileup -cf /data/results/Solid0065/referencia_genoma_humano/GRch37.58/hg19.fa F3_no_dup.bam > F3_no_dup.pileup

# Overlapping capture intervals will get together
sg_unificar_intervalos_de_captura_solapantes.pl /data/results/Solid0065/BF11_Cardio-cancer/diseno/cardio/chr1.bed > chr1_intervalos_sondas
sg_unificar_intervalos_de_captura_solapantes.pl /data/results/Solid0065/BF11_Cardio-cancer/diseno/cardio/chr10.bed > chr10_intervalos_sondas
sg_unificar_intervalos_de_captura_solapantes.pl /data/results/Solid0065/BF11_Cardio-cancer/diseno/cardio/chr11.bed > chr11_intervalos_sondas
sg_unificar_intervalos_de_captura_solapantes.pl /data/results/Solid0065/BF11_Cardio-cancer/diseno/cardio/chr12.bed > chr12_intervalos_sondas
sg_unificar_intervalos_de_captura_solapantes.pl /data/results/Solid0065/BF11_Cardio-cancer/diseno/cardio/chr13.bed > chr13_intervalos_sondas
sg_unificar_intervalos_de_captura_solapantes.pl /data/results/Solid0065/BF11_Cardio-cancer/diseno/cardio/chr14.bed > chr14_intervalos_sondas
sg_unificar_intervalos_de_captura_solapantes.pl /data/results/Solid0065/BF11_Cardio-cancer/diseno/cardio/chr15.bed > chr15_intervalos_sondas
sg_unificar_intervalos_de_captura_solapantes.pl /data/results/Solid0065/BF11_Cardio-cancer/diseno/cardio/chr16.bed > chr16_intervalos_sondas
sg_unificar_intervalos_de_captura_solapantes.pl /data/results/Solid0065/BF11_Cardio-cancer/diseno/cardio/chr17.bed > chr17_intervalos_sondas
sg_unificar_intervalos_de_captura_solapantes.pl /data/results/Solid0065/BF11_Cardio-cancer/diseno/cardio/chr18.bed > chr18_intervalos_sondas
sg_unificar_intervalos_de_captura_solapantes.pl /data/results/Solid0065/BF11_Cardio-cancer/diseno/cardio/chr19.bed > chr19_intervalos_sondas
sg_unificar_intervalos_de_captura_solapantes.pl /data/results/Solid0065/BF11_Cardio-cancer/diseno/cardio/chr2.bed > chr2_intervalos_sondas
sg_unificar_intervalos_de_captura_solapantes.pl /data/results/Solid0065/BF11_Cardio-cancer/diseno/cardio/chr20.bed > chr20_intervalos_sondas
sg_unificar_intervalos_de_captura_solapantes.pl /data/results/Solid0065/BF11_Cardio-cancer/diseno/cardio/chr21.bed > chr21_intervalos_sondas
sg_unificar_intervalos_de_captura_solapantes.pl /data/results/Solid0065/BF11_Cardio-cancer/diseno/cardio/chr22.bed > chr22_intervalos_sondas
sg_unificar_intervalos_de_captura_solapantes.pl /data/results/Solid0065/BF11_Cardio-cancer/diseno/cardio/chr3.bed > chr3_intervalos_sondas
sg_unificar_intervalos_de_captura_solapantes.pl /data/results/Solid0065/BF11_Cardio-cancer/diseno/cardio/chr4.bed > chr4_intervalos_sondas
sg_unificar_intervalos_de_captura_solapantes.pl /data/results/Solid0065/BF11_Cardio-cancer/diseno/cardio/chr5.bed > chr5_intervalos_sondas
sg_unificar_intervalos_de_captura_solapantes.pl /data/results/Solid0065/BF11_Cardio-cancer/diseno/cardio/chr6.bed > chr6_intervalos_sondas
sg_unificar_intervalos_de_captura_solapantes.pl /data/results/Solid0065/BF11_Cardio-cancer/diseno/cardio/chr7.bed > chr7_intervalos_sondas
sg_unificar_intervalos_de_captura_solapantes.pl /data/results/Solid0065/BF11_Cardio-cancer/diseno/cardio/chr8.bed > chr8_intervalos_sondas
sg_unificar_intervalos_de_captura_solapantes.pl /data/results/Solid0065/BF11_Cardio-cancer/diseno/cardio/chr9.bed > chr9_intervalos_sondas
sg_unificar_intervalos_de_captura_solapantes.pl /data/results/Solid0065/BF11_Cardio-cancer/diseno/cardio/chrM.bed > chrM_intervalos_sondas
sg_unificar_intervalos_de_captura_solapantes.pl /data/results/Solid0065/BF11_Cardio-cancer/diseno/cardio/chrX.bed > chrX_intervalos_sondas
sg_unificar_intervalos_de_captura_solapantes.pl /data/results/Solid0065/BF11_Cardio-cancer/diseno/cardio/chrY.bed > chrY_intervalos_sondas

# the piled up sequences (with no duplicates) get split into the different chromosomes
awk '{if ($1=="chr1") print $0}' F3_no_dup.pileup > chr1.pileup
awk '{if ($1=="chr2") print $0}' F3_no_dup.pileup > chr2.pileup
awk '{if ($1=="chr3") print $0}' F3_no_dup.pileup > chr3.pileup
awk '{if ($1=="chr4") print $0}' F3_no_dup.pileup > chr4.pileup
awk '{if ($1=="chr5") print $0}' F3_no_dup.pileup > chr5.pileup
awk '{if ($1=="chr6") print $0}' F3_no_dup.pileup > chr6.pileup
awk '{if ($1=="chr7") print $0}' F3_no_dup.pileup > chr7.pileup
awk '{if ($1=="chr8") print $0}' F3_no_dup.pileup > chr8.pileup
awk '{if ($1=="chr9") print $0}' F3_no_dup.pileup > chr9.pileup
awk '{if ($1=="chr10") print $0}' F3_no_dup.pileup > chr10.pileup
awk '{if ($1=="chr11") print $0}' F3_no_dup.pileup > chr11.pileup
awk '{if ($1=="chr12") print $0}' F3_no_dup.pileup > chr12.pileup
awk '{if ($1=="chr13") print $0}' F3_no_dup.pileup > chr13.pileup
awk '{if ($1=="chr14") print $0}' F3_no_dup.pileup > chr14.pileup
awk '{if ($1=="chr15") print $0}' F3_no_dup.pileup > chr15.pileup
awk '{if ($1=="chr16") print $0}' F3_no_dup.pileup > chr16.pileup
awk '{if ($1=="chr17") print $0}' F3_no_dup.pileup > chr17.pileup
awk '{if ($1=="chr18") print $0}' F3_no_dup.pileup > chr18.pileup
awk '{if ($1=="chr19") print $0}' F3_no_dup.pileup > chr19.pileup
awk '{if ($1=="chr20") print $0}' F3_no_dup.pileup > chr20.pileup
awk '{if ($1=="chr21") print $0}' F3_no_dup.pileup > chr21.pileup
awk '{if ($1=="chr22") print $0}' F3_no_dup.pileup > chr22.pileup
awk '{if ($1=="chrX") print $0}' F3_no_dup.pileup > chrX.pileup
awk '{if ($1=="chrY") print $0}' F3_no_dup.pileup > chrY.pileup
awk '{if ($1=="chrM") print $0}' F3_no_dup.pileup > chrM.pileup

# the piled up sequences in range from each chromosome are obtained
sg_extraer_SNPs_fichero_tabulado.pl chr1_intervalos_sondas chr1.pileup > chr1.enrango
sg_extraer_SNPs_fichero_tabulado.pl chr10_intervalos_sondas chr10.pileup > chr10.enrango
sg_extraer_SNPs_fichero_tabulado.pl chr11_intervalos_sondas chr11.pileup > chr11.enrango
sg_extraer_SNPs_fichero_tabulado.pl chr12_intervalos_sondas chr12.pileup > chr12.enrango
sg_extraer_SNPs_fichero_tabulado.pl chr13_intervalos_sondas chr13.pileup > chr13.enrango
sg_extraer_SNPs_fichero_tabulado.pl chr14_intervalos_sondas chr14.pileup > chr14.enrango
sg_extraer_SNPs_fichero_tabulado.pl chr15_intervalos_sondas chr15.pileup > chr15.enrango
sg_extraer_SNPs_fichero_tabulado.pl chr16_intervalos_sondas chr16.pileup > chr16.enrango
sg_extraer_SNPs_fichero_tabulado.pl chr17_intervalos_sondas chr17.pileup > chr17.enrango
sg_extraer_SNPs_fichero_tabulado.pl chr18_intervalos_sondas chr18.pileup > chr18.enrango
sg_extraer_SNPs_fichero_tabulado.pl chr19_intervalos_sondas chr19.pileup > chr19.enrango
sg_extraer_SNPs_fichero_tabulado.pl chr2_intervalos_sondas chr2.pileup > chr2.enrango
sg_extraer_SNPs_fichero_tabulado.pl chr20_intervalos_sondas chr20.pileup > chr20.enrango
sg_extraer_SNPs_fichero_tabulado.pl chr21_intervalos_sondas chr21.pileup > chr21.enrango
sg_extraer_SNPs_fichero_tabulado.pl chr22_intervalos_sondas chr22.pileup > chr22.enrango
sg_extraer_SNPs_fichero_tabulado.pl chr3_intervalos_sondas chr3.pileup > chr3.enrango
sg_extraer_SNPs_fichero_tabulado.pl chr4_intervalos_sondas chr4.pileup > chr4.enrango
sg_extraer_SNPs_fichero_tabulado.pl chr5_intervalos_sondas chr5.pileup > chr5.enrango
sg_extraer_SNPs_fichero_tabulado.pl chr6_intervalos_sondas chr6.pileup > chr6.enrango
sg_extraer_SNPs_fichero_tabulado.pl chr7_intervalos_sondas chr7.pileup > chr7.enrango
sg_extraer_SNPs_fichero_tabulado.pl chr8_intervalos_sondas chr8.pileup > chr8.enrango
sg_extraer_SNPs_fichero_tabulado.pl chr9_intervalos_sondas chr9.pileup > chr9.enrango
sg_extraer_SNPs_fichero_tabulado.pl chrM_intervalos_sondas chrM.pileup > chrM.enrango
sg_extraer_SNPs_fichero_tabulado.pl chrX_intervalos_sondas chrX.pileup > chrX.enrango
sg_extraer_SNPs_fichero_tabulado.pl chrY_intervalos_sondas chrY.pileup > chrY.enrango

# Call of SNPs without duplicates and quality values over 20
/share/apps/samtools-0.1.9/misc/samtools.pl varFilter -D 500000 F3_no_dup.pileup | awk '$6>=20' | awk '{if ($4!="*") print $0}' > snps_sin_duplicados_Q20

# the SNPs get split into the different chromosomes
awk '{if ($1=="chr1") print $0}' snps_sin_duplicados_Q20  > chr1.snps
awk '{if ($1=="chr10") print $0}' snps_sin_duplicados_Q20  > chr10.snps 
awk '{if ($1=="chr11") print $0}' snps_sin_duplicados_Q20  > chr11.snps
awk '{if ($1=="chr12") print $0}' snps_sin_duplicados_Q20  > chr12.snps
awk '{if ($1=="chr13") print $0}' snps_sin_duplicados_Q20  > chr13.snps
awk '{if ($1=="chr14") print $0}' snps_sin_duplicados_Q20  > chr14.snps
awk '{if ($1=="chr15") print $0}' snps_sin_duplicados_Q20  > chr15.snps
awk '{if ($1=="chr16") print $0}' snps_sin_duplicados_Q20  > chr16.snps
awk '{if ($1=="chr17") print $0}' snps_sin_duplicados_Q20  > chr17.snps
awk '{if ($1=="chr18") print $0}' snps_sin_duplicados_Q20  > chr18.snps
awk '{if ($1=="chr19") print $0}' snps_sin_duplicados_Q20  > chr19.snps
awk '{if ($1=="chr2") print $0}' snps_sin_duplicados_Q20  > chr2.snps
awk '{if ($1=="chr20") print $0}' snps_sin_duplicados_Q20  > chr20.snps
awk '{if ($1=="chr21") print $0}' snps_sin_duplicados_Q20  > chr21.snps
awk '{if ($1=="chr22") print $0}' snps_sin_duplicados_Q20  > chr22.snps
awk '{if ($1=="chr3") print $0}' snps_sin_duplicados_Q20  > chr3.snps
awk '{if ($1=="chr4") print $0}' snps_sin_duplicados_Q20  > chr4.snps
awk '{if ($1=="chr5") print $0}' snps_sin_duplicados_Q20  > chr5.snps
awk '{if ($1=="chr6") print $0}' snps_sin_duplicados_Q20  > chr6.snps
awk '{if ($1=="chr7") print $0}' snps_sin_duplicados_Q20  > chr7.snps
awk '{if ($1=="chr8") print $0}' snps_sin_duplicados_Q20  > chr8.snps
awk '{if ($1=="chr9") print $0}' snps_sin_duplicados_Q20  > chr9.snps
awk '{if ($1=="chrM") print $0}' snps_sin_duplicados_Q20  > chrM.snps
awk '{if ($1=="chrX") print $0}' snps_sin_duplicados_Q20  > chrX.snps
awk '{if ($1=="chrY") print $0}' snps_sin_duplicados_Q20  > chrY.snps

# the SNPs in range from each chromosome are obtained
sg_extraer_SNPs_fichero_tabulado.pl chr1_intervalos_sondas chr1.snps > chr1_snps.enrango
sg_extraer_SNPs_fichero_tabulado.pl chr10_intervalos_sondas chr10.snps > chr10_snps.enrango
sg_extraer_SNPs_fichero_tabulado.pl chr11_intervalos_sondas chr11.snps > chr11_snps.enrango
sg_extraer_SNPs_fichero_tabulado.pl chr12_intervalos_sondas chr12.snps > chr12_snps.enrango
sg_extraer_SNPs_fichero_tabulado.pl chr13_intervalos_sondas chr13.snps > chr13_snps.enrango
sg_extraer_SNPs_fichero_tabulado.pl chr14_intervalos_sondas chr14.snps > chr14_snps.enrango
sg_extraer_SNPs_fichero_tabulado.pl chr15_intervalos_sondas chr15.snps > chr15_snps.enrango
sg_extraer_SNPs_fichero_tabulado.pl chr16_intervalos_sondas chr16.snps > chr16_snps.enrango
sg_extraer_SNPs_fichero_tabulado.pl chr17_intervalos_sondas chr17.snps > chr17_snps.enrango
sg_extraer_SNPs_fichero_tabulado.pl chr18_intervalos_sondas chr18.snps > chr18_snps.enrango
sg_extraer_SNPs_fichero_tabulado.pl chr19_intervalos_sondas chr19.snps > chr19_snps.enrango
sg_extraer_SNPs_fichero_tabulado.pl chr2_intervalos_sondas chr2.snps > chr2_snps.enrango
sg_extraer_SNPs_fichero_tabulado.pl chr20_intervalos_sondas chr20.snps > chr20_snps.enrango
sg_extraer_SNPs_fichero_tabulado.pl chr21_intervalos_sondas chr21.snps > chr21_snps.enrango
sg_extraer_SNPs_fichero_tabulado.pl chr22_intervalos_sondas chr22.snps > chr22_snps.enrango
sg_extraer_SNPs_fichero_tabulado.pl chr3_intervalos_sondas chr3.snps > chr3_snps.enrango
sg_extraer_SNPs_fichero_tabulado.pl chr4_intervalos_sondas chr4.snps > chr4_snps.enrango
sg_extraer_SNPs_fichero_tabulado.pl chr5_intervalos_sondas chr5.snps > chr5_snps.enrango
sg_extraer_SNPs_fichero_tabulado.pl chr6_intervalos_sondas chr6.snps > chr6_snps.enrango
sg_extraer_SNPs_fichero_tabulado.pl chr7_intervalos_sondas chr7.snps > chr7_snps.enrango
sg_extraer_SNPs_fichero_tabulado.pl chr8_intervalos_sondas chr8.snps > chr8_snps.enrango
sg_extraer_SNPs_fichero_tabulado.pl chr9_intervalos_sondas chr9.snps > chr9_snps.enrango
sg_extraer_SNPs_fichero_tabulado.pl chrM_intervalos_sondas chrM.snps > chrM_snps.enrango
sg_extraer_SNPs_fichero_tabulado.pl chrX_intervalos_sondas chrX.snps > chrX_snps.enrango
sg_extraer_SNPs_fichero_tabulado.pl chrY_intervalos_sondas chrY.snps > chrY_snps.enrango

# The in range SNPs from the differente chromosomes are merged into one file (todos_SNP)
cat chr1_snps.enrango chr10_snps.enrango chr11_snps.enrango chr12_snps.enrango chr13_snps.enrango chr14_snps.enrango chr15_snps.enrango chr16_snps.enrango chr17_snps.enrango chr18_snps.enrango chr19_snps.enrango chr2_snps.enrango chr20_snps.enrango chr21_snps.enrango chr22_snps.enrango chr3_snps.enrango chr4_snps.enrango chr5_snps.enrango chr6_snps.enrango chr7_snps.enrango chr8_snps.enrango chr9_snps.enrango chrM_snps.enrango chrX_snps.enrango chrY_snps.enrango > todos_SNP

# Conversion from heterozygote to homozygote
sg_convertir_SNPs_de_heterocigotos_a_homocigotos.pl todos_SNP > todos_SNP_OK

# The SNPs get filtered
variant_effect_predictor_15-2-11.pl -i todos_SNP_OK -o SNVs.SNVs

# Annotation will be added to the SNPs file
sg_combinar_output_samtools_anotacion_SNP_effect.pl todos_SNP todos_SNP_OK

# Coverage results are obtained
for f in chr*.pileup; do echo $f; awk '{print $8}' $f > "${f}"_coverage; sg_sumatorio_columna.pl "${f}"_coverage | grep Sumatorio; done > results_nt_mapeables
rm *_coverage
for f in $(ls *.enrango | grep -v snps ); do echo $f; awk '{print $8}' $f > "${f}"_coverage; sg_sumatorio_columna.pl "${f}"_coverage | grep Sumatorio; done > results_nt_enrango
rm *_coverage
for f in $(ls *.near_target ); do echo $f; awk '{print $8}' $f > "${f}"_coverage; sg_sumatorio_columna.pl "${f}"_coverage | grep Sumatorio; done > results_nt_neartarget
rm *_coverage
for f in $(ls *.enrango | grep -v snps ); do echo $f; awk '{if ( $8 >= 1) print $1}' $f | wc -l; done > results_nt_1x
for f in $(ls *.enrango | grep -v snps ); do echo $f; awk '{if ( $8 >= 10) print $1}' $f | wc -l; done > results_nt_10x
for f in $(ls *.enrango | grep -v snps ); do echo $f; awk '{if ( $8 >= 20) print $1}' $f | wc -l; done > results_nt_20x

# SNVs results are joined together
echo resultados de SNVs > results_SNVs
echo SNVs totales: >> results_SNVs
wc todos_SNP >> results_SNVs
echo SNVs nuevos: >> results_SNVs
for f in $(ls SNVs.SNVs); do awk '{if ($9=="-") print $1"_"$2}' $f | sort -u | wc -l; done >> results_SNVs
echo SNVs no-sinónimos: >> results_SNVs
for f in $(ls SNVs.SNVs); do grep NON_SYNONYMOUS_CODING $f | awk '{print $1"_"$2}' | sort -u | wc -l; done >> results_SNVs
echo SNVs zonas de splicing: >> results_SNVs
for f in $(ls SNVs.SNVs); do grep SPLICE $f | awk '{print $1"_"$2}' | sort -u | wc -l; done >> results_SNVs
echo SNVs nuevos no-sinónimos: >> results_SNVs
for f in $(ls SNVs.SNVs); do grep NON_SYNONYMOUS_CODING $f | awk '{if ($9=="-") print $1"_"$2}' | sort -u | wc -l; done >> results_SNVs
echo SNVs nuevos zonas de splicing: >> results_SNVs
for f in $(ls SNVs.SNVs); do grep SPLICE $f | awk '{if ($9=="-") print $1"_"$2}' | sort -u | wc -l; done >> results_SNVs

